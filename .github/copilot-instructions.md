# ROS Workspace Copilot Instructions

## Project Overview

This is a **ROS 2 (Robot Operating System 2) workspace** using Python with the `ament_python` build system. The workspace contains perception-based robotics packages.

### Architecture
- **Workspace Root**: `/ros_ws` - Standard ROS 2 workspace structure
- **Source Packages**: `src/` - Contains ROS 2 packages (currently `perception`)
- **Build/Install Artifacts**: `build/`, `install/`, `log/` - Auto-generated by colcon (ROS build tool)
- **Perception Package**: `src/perception/` - Python-based package using rclpy for ROS 2 node communication

### Key Technologies
- **ROS 2**: Robot middleware for inter-process communication (IPC) via message passing
- **rclpy**: Python client library for ROS 2
- **ament_python**: ROS 2 build system for Python packages
- **cv_bridge**: Bridges between ROS image messages and OpenCV

## Essential Workflows

### Building the Workspace
```bash
cd /Users/omarshaqaqi/Desktop/projects/ros_ws
colcon build
```
This compiles packages and generates `build/`, `install/`, and `log/` directories. Always rebuild after modifying `.msg` files or entry points.

### Running Tests
```bash
colcon test
```
Runs all linters and unit tests:
- `ament_flake8` - Code style (PEP 8)
- `ament_pep257` - Docstring style
- `ament_copyright` - Copyright headers (currently skipped in `test_copyright.py`)

### Sourcing the Environment
```bash
source install/setup.zsh  # For zsh shell
```
This adds compiled packages to `$ROS_PACKAGE_PATH` and `$PYTHONPATH`. Must be run in new shells.

## ROS 2 Package Structure

All packages follow this layout:
```
package_name/
├── package.xml           # Package metadata and dependencies
├── setup.py              # Python package setup
├── setup.cfg             # Build configuration
├── package_name/         # Python module directory
│   ├── __init__.py
│   ├── msg/             # Message definitions (.msg files)
│   └── [nodes]          # ROS 2 node implementations
├── test/                # Linter tests (not unit tests)
└── resource/            # Resource files
```

## Message Definition Pattern

Custom ROS 2 messages are defined in `.msg` files (e.g., `perception/msg/BlockDetection.msg`):
- Fields: `type field_name` (one per line)
- Supported types: `string`, `int32`, `float32`, `bool`, `uint8[]` (arrays), etc.
- After modifying `.msg` files, **rebuild workspace** (`colcon build`) to regenerate Python classes

### Example: BlockDetection Message
```
string color              # Detected block color
int32 pixel_x            # X coordinate in image
int32 pixel_y            # Y coordinate in image
int32 width              # Block width in pixels
int32 height             # Block height in pixels
float32 confidence       # Detection confidence [0.0, 1.0]
```

## Dependencies & Configuration

### perception Package Dependencies
- **rclpy**: ROS 2 Python client library
- **sensor_msgs**: ROS standard message types (e.g., Image)
- **std_msgs**: Basic ROS message types (e.g., Int32, String)
- **cv_bridge**: Convert between ROS image messages and OpenCV/NumPy arrays
- **Test dependencies**: ament_copyright, ament_flake8, ament_pep257, pytest

All dependencies are declared in `package.xml` as `<depend>` tags (runtime) or `<test_depend>` tags (test-only).

## Development Conventions

1. **Entry Points**: Add console scripts in `setup.py` under `entry_points['console_scripts']` to make ROS 2 nodes executable as commands
2. **Linting**: Code must pass flake8 and pep257 checks - no ignored rules without justification
3. **Docstrings**: All modules, classes, and functions must have docstrings (PEP 257)
4. **Copyright**: Add Apache 2.0 license headers to new source files (currently optional per test_copyright.py)
5. **Node Pattern**: ROS 2 nodes inherit from `rclpy.node.Node` and use subscriptions/publishers for communication

## Common Tasks

**Add a new message type**: Create `.msg` file in `package/msg/`, then rebuild
**Create a new ROS 2 node**: Add Python module to package directory, inherit from `rclpy.node.Node`, add entry point in `setup.py`
**Debug a node**: Use `ros2 run perception node_name` after sourcing environment
**Check package health**: Run `colcon test` to validate linting compliance
